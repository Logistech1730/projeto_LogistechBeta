<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alertas</title>
  <link rel="stylesheet" href="../styles/barraLateral.css">
  <link rel="stylesheet" href="../styles/alertas.css">
  <!-- Import de fontes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
</head>

<body>
  <div class="container-dash">
    <div class="barra-lateral">
        <div class="div-imagem-perfil">
            <img src="../img/perfilexemplo.png" class="perfil-foto" alt="foto de perfil">
        </div>
        <h4>EletronicGear Ltda.</h4>
        <div class="option selected">
            <i class="fa-solid fa-chart-line"></i>
            <span><a href="./dashboard.html">Dashboard</a></span>
        </div>
        <div class="option">
            <i class="fa-solid fa-circle-plus"></i>
            <span><a href="./cadastroEsteira.html">Esteira</a></span>
        </div>
        <div class="option">
            <i class="fa-solid fa-book"></i>
            <span><a href="./historico.html">Histórico</a></span>
        </div>
        <div class="option">
            <i class="fa-regular fa-bell"></i>
            <span><a href="./alertas.html">Alertas</a></span>
        </div>
        <div class="option">
          <i class="fa-solid fa-gauge"></i>
          <span><a href="./metricas.html">Métricas</a></span>
      </div>
        <div class="option">
            <i class="fa-solid fa-user"></i>
            <span><a href="./cadastroFuncionario.html">Funcionários</a></span>
        </div>
        <div class="option">
            <i class="fa-solid fa-door-open"></i>
            <span><a href="../index.html">Sair</a></span>
        </div>
    </div>
    <div class="alertas">
      <h1>Alertas</h1>
      <p>Aqui são listados todos os alertas capturados pelos Esteiras</p>
      <div class="filtros">
        <div class="ver-vistos">
           <p>Ver não vistos</p>
            <input type="checkbox" id="chk_vistos">
        </div>
        <div id="container-dtInicio">
          <label for="container-dtInicio">Data de Início</label>
          <input type="date" id="data1">
        </div>
        <div id="container-dtFinal">
          <label for="container-dtFinal">Data final</label>
          <input type="date" id="data2">
        </div>
        <button id="botao-filtro" onclick="aplicarFiltro()">Aplicar Filtros</button>
      </div>
      <div class="table-container">
        <table id="tabela">

            <thead>
              <tr>
                <th>Esteira</th>
                <th>Altura detectada</th>
                <th>Data</th>
                <th>Visto</th>
              </tr>
            </thead>

            <tbody></tbody>

          </table>
          
      </div>


    </div>
  </div>
</body>

</html>
<script>
  function listarAlertas() {
      fetch(`/alertas/listar/${sessionStorage.idEmpresa}`, {
          method: 'GET',
          headers: {
              'Content-Type': 'application/json',
          },
      })
          .then((response) => {
              if (response.ok) {
                  return response.json();
              } else {
                  throw new Error('Erro ao buscar os alertas.');
              }
          })
          .then((alertas) => {
              console.log("Alertas recebidos:", alertas);
              let conteudo_tabela = "";

              if (alertas.length === 0) {
                  conteudo_tabela = `
                      <tr>
                          <td colspan="4">Nenhum alerta encontrado.</td>
                      </tr>`;
              } else {
                  for (let contador = 0; contador < alertas.length; contador++) {
                      const { Esteira, distancia, Data, Visto } = alertas[contador];
                      const data = new Date(Data);
                      const dataFormatada = data.toLocaleString('pt-BR');
                      const checkboxVisto = Visto === "Sim" ? "checked" : "";

                      conteudo_tabela += `
                      <tr>
                          <td>${Esteira}</td>
                          <td>${distancia} cm</td>
                          <td>${dataFormatada}</td>
                          <td><input type="checkbox" ${checkboxVisto}></td>
                      </tr>`;
                  }
              }

              const tabelaRegistros = document.querySelector("#tabela tbody");
              tabelaRegistros.innerHTML = conteudo_tabela;
          })
          .catch((erro) => {
              console.error('Erro ao listar alertas:', erro);
              alert('Erro ao listar alertas.');
          });
  }

  document.addEventListener("DOMContentLoaded", listarAlertas);
</script>
