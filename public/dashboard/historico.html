<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Histórico</title>
  <link rel="stylesheet" href="../styles/barraLateral.css">
  <link rel="stylesheet" href="../styles/historico.css">
  <!-- Import de fontes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
</head>

<body onload="listarRegistros()">
  <div class="container-dash">
    <div class="barra-lateral">
      <div class="div-imagem-perfil">
          <img src="../img/perfilexemplo.png" class="perfil-foto" alt="foto de perfil">
      </div>
      <h4>EletronicGear Ltda.</h4>
      <div class="option selected">
          <i class="fa-solid fa-chart-line"></i>
          <span><a href="./dashboard.html">Dashboard</a></span>
      </div>
      <div class="option">
          <i class="fa-solid fa-circle-plus"></i>
          <span><a href="./cadastroEsteira.html">Esteira</a></span>
      </div>
      <div class="option">
          <i class="fa-solid fa-book"></i>
          <span><a href="./historico.html">Histórico</a></span>
      </div>
      <div class="option">
          <i class="fa-regular fa-bell"></i>
          <span><a href="./alertas.html">Alertas</a></span>
      </div>

      <div class="option">
        <i class="fa-solid fa-gauge"></i>
        <span><a href="./metricas.html">Métricas</a></span>
    </div>

      <div class="option">
          <i class="fa-solid fa-user"></i>
          <span><a href="./cadastroFuncionario.html">Funcionários</a></span>
      </div>
      <div class="option">
          <i class="fa-solid fa-door-open"></i>
          <span><a href="../index.html">Sair</a></span>
      </div>
  </div>
    <div class="historico">
      <h1>Histórico</h1>
      <p>Aqui são listados todos os registros capturados pelos Esteiras</p>
      <div class="filtros">
        <div id="container-dtInicio">
          <label for="container-dtInicio">Data de Início</label>
          <input type="date" id="data1">
        </div>
        <div id="container-dtFinal">
          <label for="container-dtFinal">Data final</label>
          <input type="date" id="data2">
        </div>
        <button id="botao-filtro" onclick="aplicarFiltro()">Aplicar Filtros</button>
        <button id="botao-filtro" onclick="window.location.reload()">Limpar filtros</button>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Esteira</th>
              <th>Altura detectada</th>
              <th>Data e Horário</th>
            </tr>
          </thead>
          <tbody id="tabela_registros">
            
            
          </tbody>
        </table>
      </div>


    </div>
  </div>
</body>

</html>
<script>
  function aplicarFiltro() {
    // validação de data
    var data_inicial = data1.value;
    var data_final = data2.value;
    if (data_inicial > data_final) {
      alert("A data inicial não pode ser maior que a final!");
      return;
    }

    fetch(`/registros/listarPorData/${sessionStorage.idEmpresa}`, {
      method: "POST",
      headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              dataInicial: data_inicial,
              dataFinal: data_final
            })
    })
    .then((response) => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Erro ao buscar as esteiras.');
                }
            })
            .then((esteiras) => {
                console.log("Esteiras recebidas:", esteiras);
                var conteudo_tabela = ""
                for (var contador = 0; contador < esteiras.length; contador++) {
                  var nomeEsteira = esteiras[contador].Esteira;
                  var AlturaDetectada = esteiras[contador].AlturaDetectada;
                  var DataRegistro = esteiras[contador].DataRegistro;
                  var data = new Date(DataRegistro);
                  var dataFormatada = data.toLocaleString('pt-BR');
                  conteudo_tabela += `
                  <tr>
                    <td>${nomeEsteira}</td>
                    <td>${AlturaDetectada} cm</td>
                    <td>${dataFormatada}</td>
                  </tr>`
                }
                tabela_registros.innerHTML = conteudo_tabela;
            })
    .catch((erro) => {
                console.error('Erro ao listar esteiras:', erro);
                alert('Erro ao listar esteiras.');
            });
  }
  function listarRegistros() {
        fetch(`/registros/listar/${sessionStorage.idEmpresa}`, {
            method: 'GET',
            
        })
            .then((response) => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Erro ao buscar as esteiras.');
                }
            })
            .then((esteiras) => {
                console.log("Esteiras recebidas:", esteiras);
                var conteudo_tabela = ""
                for (var contador = 0; contador < esteiras.length; contador++) {
                  var nomeEsteira = esteiras[contador].Esteira;
                  var AlturaDetectada = esteiras[contador].AlturaDetectada;
                  var DataRegistro = esteiras[contador].DataRegistro;
                  var data = new Date(DataRegistro);
                  var dataFormatada = data.toLocaleString('pt-BR');
                  conteudo_tabela += `
                  <tr>
                    <td>${nomeEsteira}</td>
                    <td>${AlturaDetectada} cm</td>
                    <td>${dataFormatada}</td>
                  </tr>`
                }
                tabela_registros.innerHTML = conteudo_tabela;
            })
            .catch((erro) => {
                console.error('Erro ao listar esteiras:', erro);
                alert('Erro ao listar esteiras.');
            });
    }
</script>